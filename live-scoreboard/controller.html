<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Controller â€“ Live Soccer Scoreboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Global Styles -->
  <link rel="stylesheet" href="css/main.css" />
  <!-- Controller Styles -->
  <link rel="stylesheet" href="css/controller.css" />
</head>

<body class="controller">

  <!-- HEADER -->
  <header class="controller-header">
    <h1>âš½ Match Controller</h1>
    <div class="display-status">
      Displays Connected: <strong data-bind="display-count">0</strong>
    </div>
  </header>

  <!-- MAIN -->
  <main class="controller-main">

    <!-- SCOREBOARD -->
    <section class="scoreboard-panel">

      <div class="team-panel home">
        <div class="logo-wrapper">
           <img id="logoHome" class="team-logo" alt="Home Logo" />
           <button class="btn-icon view-logo" data-action="view-logo-home">ğŸ‘ï¸</button>
        </div>
        <div class="team-name" data-bind="team-home-name"></div>
        <div class="team-score" data-bind="score-home">0</div>
        <button class="btn goal" data-action="goal-home">+ Goal</button>
      </div>

      <div class="center-panel">
        <div class="period">
          <span data-bind="period">PRE_MATCH</span>
        </div>
        <div class="timer-container">
           <div class="timer" data-bind="timer">00:00</div>
           <div class="extra-time" data-bind="extra-time"></div>
        </div>
      </div>

      <div class="team-panel away">
        <div class="logo-wrapper">
           <img id="logoAway" class="team-logo" alt="Away Logo" />
           <button class="btn-icon view-logo" data-action="view-logo-away">ğŸ‘ï¸</button>
        </div>
        <div class="team-name" data-bind="team-away-name"></div>
        <div class="team-score" data-bind="score-away">0</div>
        <button class="btn goal" data-action="goal-away">+ Goal</button>
      </div>

    </section>

    <!-- CONTROLS GRID -->
    <section class="controls-grid">

      <!-- TIMER -->
      <div class="control-card">
        <h3>Timer</h3>
        <button data-action="start-timer">â–¶ Start</button>
        <button data-action="pause-timer">â¸ Pause</button>
        <button data-action="undo">â†© Undo Goal</button>
      </div>

      <!-- PERIOD -->
      <div class="control-card">
        <h3>Match Period</h3>
        <button data-action="start-first-half">1st Half</button>
        <button data-action="half-time">Halftime</button>
        <button data-action="start-second-half">2nd Half</button>
        <button data-action="end-match">Fulltime</button>
        <button data-action="add-extra-time">+ Extra Time</button>
        <button data-action="undo-period" class="btn-secondary">â†© Undo</button>
      </div>

      <!-- SUBSTITUTIONS -->
      <div class="control-card">
        <h3>Substitutions</h3>
        <div class="sub-row">
          <span data-bind="team-home-name"></span>
          <button data-action="sub-home">ğŸ”„ Sub</button>
        </div>
        <div class="sub-row">
          <span data-bind="team-away-name"></span>
          <button data-action="sub-away">ğŸ”„ Sub</button>
        </div>
        <button data-action="undo-sub">â†© Undo Sub</button>
      </div>

    </section>

    <!-- DEBUG -->
    <section class="debug-panel collapsed" id="debugPanel">
      <div class="debug-header" id="toggleDebug">
        <h3>ğŸ”§ Debug Console (Click to Expand)</h3>
        <span class="toggle-icon">â–²</span>
      </div>
      <div class="debug-content">
        <pre id="matchStateDebug"></pre>
      </div>
    </section>

  </main>

  <!-- SCRIPTS -->
  <script src="js/init.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/matchState.js"></script>
  <script src="js/sync.js"></script>
  <script src="js/timer.js"></script>
  <script src="js/controller-ui.js"></script>

  <!-- Info Button -->
  <button id="infoBtn" class="info-btn">i</button>
  
  <!-- Info Modal -->
  <div id="infoModal" class="modal-overlay">
    <div class="modal-content">
      <button class="close-modal" id="closeModal">&times;</button>
      <div class="instructions-body">
        <h2>Controller Guide</h2>
        <ul>
          <li><strong>Start/Pause:</strong> Control the match timer.</li>
          <li><strong>Periods:</strong> Switch between halves.</li>
          <li><strong>Goals:</strong> Add goals for teams (auto-undo supported).</li>
          <li><strong>Subs:</strong> Manage player substitutions.</li>
          <li><strong>Extra Time:</strong> Add time at end of periods.</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- LOAD LOGOS -->
  <script>
    (function () {
      const qs = new URLSearchParams(location.search);
      const matchId = qs.get("matchId") || "local";

      function loadLogo(key, el) {
        try {
          const img = (key === 'homeLogo' ? qs.get('logoA') : qs.get('logoB')) || localStorage.getItem(`${matchId}:${key}`);
          if (img && el) el.src = img;
        } catch (e) {}
      }

      loadLogo("homeLogo", document.getElementById("logoHome"));
      loadLogo("awayLogo", document.getElementById("logoAway"));

      try {
        const setup = JSON.parse(localStorage.getItem(`${matchId}:setup`)) || {};
        const nameA = setup.teamA && setup.teamA.name ? setup.teamA.name : "";
        const nameB = setup.teamB && setup.teamB.name ? setup.teamB.name : "";
        document.querySelectorAll('[data-bind="team-home-name"]').forEach(el => el.textContent = nameA);
        document.querySelectorAll('[data-bind="team-away-name"]').forEach(el => el.textContent = nameB);
      } catch (e) {}
    })();
  </script>

</body>
</html>
